import React, { useState, useEffect } from 'react';
import { Heart, MapPin, Clock, Calendar, Info, CheckCircle, AlertCircle, ChevronRight, Filter, Baby, Timer, FileText, Users, CircleDollarSign, User, Hourglass } from 'lucide-react';

// -----------------------------------------------------------------------------
// ãƒ‡ã‚¶ã‚¤ãƒ³å®šæ•°
// -----------------------------------------------------------------------------
const COLORS = {
  main: '#CDA250',       // ãƒ–ãƒ©ãƒ³ãƒ‰ã‚«ãƒ©ãƒ¼ï¼ˆã‚´ãƒ¼ãƒ«ãƒ‰ç³»ï¼‰
  sub: '#F5EFDE',        // è–„ã„èƒŒæ™¯è‰²
  text: '#4B2F16',       // ãƒ†ã‚­ã‚¹ãƒˆè‰²ï¼ˆãƒ€ãƒ¼ã‚¯ãƒ–ãƒ©ã‚¦ãƒ³ï¼‰
  white: '#FFFFFF',
  border: '#E5E7EB',     // è–„ã„ã‚°ãƒ¬ãƒ¼ã®ãƒœãƒ¼ãƒ€ãƒ¼
  
  // æ¡ˆä»¶ã‚¿ã‚¤ãƒ—ã®è‰²åˆ†ã‘
  regularMain: '#6FB8C8', // é’ç³»ãƒ™ãƒ¼ã‚¹
  regularBg: '#E2F1F4',
  
  singleMain: '#ECAD99',  // ãƒ”ãƒ³ã‚¯ç³»ãƒ™ãƒ¼ã‚¹
  singleBg: '#FDF3F0',
};

const FONT_STYLE = {
  fontFamily: '"Hiragino Kaku Gothic ProN", "Hiragino Sans", "Meiryo", sans-serif',
  color: COLORS.text,
};

// -----------------------------------------------------------------------------
// ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ (10ä»¶ - è©³ç´°ãƒ†ã‚­ã‚¹ãƒˆè¿½åŠ )
// -----------------------------------------------------------------------------
const CURRENT_MOCK_DATE = new Date('2025-12-17T12:00:00');

const JOB_LISTINGS = [
  {
    id: 1,
    type: "single", 
    date: "12/20(é‡‘) 13:00ã€œ16:00",
    location: "æ±äº¬éƒ½ ä¸–ç”°è°·åŒº (ä»£ã€…æœ¨ä¸ŠåŸé§… å¾’æ­©5åˆ†)",
    minRate: 2000,
    maxRate: 2500,
    parentHistory: 120, 
    tags: ["è‡ªå®…ä¿è‚²"], 
    childAge: "2æ­³",
    description: "ä¸»äººãŒå¸°å®…ã™ã‚‹ã¾ã§ã®ã‚·ãƒƒãƒ†ã‚£ãƒ³ã‚°å¸Œæœ›ã€‚ãŠå…„ã¡ã‚ƒã‚“ã®å°å­¦æ ¡ã§ã®ç”¨äº‹ã®é–“ã€3æ­³ã®æ¬¡ç”·ã®ã‚·ãƒƒãƒ†ã‚£ãƒ³ã‚°ã‚’ãŠé¡˜ã„ã§ãã‚‹æ–¹ã‚’æ¢ã—ã¦ãŠã‚Šã¾ã™ã€‚ãŠæ˜¼å¯ã®æ™‚é–“ã¨é‡ãªã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚",
    applyCount: 3,
    favoriteCount: 12,
    deadline: "12/19(æœ¨) 12:00",
    deadlineDate: new Date('2025-12-19T12:00:00'),
  },
  {
    id: 2,
    type: "regular",
    date: "æ¯é€±ç«æ›œ 16:00ã€œ19:00",
    duration: "2025/1/7ã€œ2025/3/31",
    location: "æ±äº¬éƒ½ æ¸‹è°·åŒº (æµæ¯”å¯¿é§… å¾’æ­©8åˆ†)",
    minRate: 2300,
    maxRate: 2800,
    parentHistory: 0, 
    tags: ["é€è¿", "è‡ªå®…ä¿è‚²"],
    childAge: "4æ­³, 0æ­³",
    description: "ä¿è‚²åœ’ã¸ã®ãŠè¿ãˆã¨ã€å¸°å®…å¾Œã®å…¥æµ´è£œåŠ©ã‚’ãŠé¡˜ã„ã—ãŸã„ã§ã™ã€‚ç§ãŒåœ¨å®…ã—ã¦ã„ã¾ã™ãŒã€ä¸‹ã®å­ï¼ˆ0æ­³ï¼‰ã®ä¸–è©±ã§æ‰‹ãŒé›¢ã›ãªã„ãŸã‚ã€ä¸Šã®å­ï¼ˆ4æ­³ï¼‰ã¨éŠã‚“ã§ã„ãŸã ã‘ã‚‹æ–¹ã‚’å‹Ÿé›†ã—ã¾ã™ã€‚",
    applyCount: 0,
    favoriteCount: 5,
    deadline: "12/31(ç«) 18:00", 
    deadlineDate: new Date('2025-12-31T18:00:00'),
  },
  {
    id: 3,
    type: "single",
    date: "12/22(æ—¥) 10:00ã€œ12:00",
    location: "æ±äº¬éƒ½ æ¸¯åŒº (åºƒå°¾é§… å¾’æ­©3åˆ†)",
    minRate: 3000,
    maxRate: 3500,
    parentHistory: 15,
    tags: ["è‡ªå®…å¤–ä¿è‚²"],
    childAge: "6æ­³",
    description: "è‹±èªã§ã®ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒå¯èƒ½ãªæ–¹ã‚’æ¢ã—ã¦ã„ã¾ã™ã€‚è¿‘ãã®æœ‰æ –å·å…¬åœ’ã§éŠã‚“ã§ã„ãŸã ãã¤ã¤ã€ç°¡å˜ãªè‹±ä¼šè©±ã®ç›¸æ‰‹ã‚’ã—ã¦ã„ãŸã ã‘ã‚‹ã¨å¬‰ã—ã„ã§ã™ã€‚",
    applyCount: 8,
    favoriteCount: 24,
    deadline: "12/21(åœŸ) 09:00",
    deadlineDate: new Date('2025-12-21T09:00:00'),
  },
  {
    id: 4,
    type: "single",
    date: "12/25(æ°´) 18:00ã€œ22:00",
    location: "æ±äº¬éƒ½ ç›®é»’åŒº (ä¸­ç›®é»’é§… å¾’æ­©10åˆ†)",
    minRate: 2500,
    maxRate: 3000,
    parentHistory: 50,
    tags: ["è‡ªå®…ä¿è‚²"],
    childAge: "1æ­³",
    description: "å¤«å©¦ã§å¤–å‡ºã®äºˆå®šãŒã‚ã‚‹ãŸã‚ã€å¤œé–“ã®è¦‹å®ˆã‚Šã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚å¤•é£Ÿã¯æ¸ˆã¾ã›ã¦ãŠãã¾ã™ã®ã§ã€å¯ã‹ã—ã¤ã‘ã®ã¿ãŠé¡˜ã„ã§ãã‚Œã°ã¨æ€ã„ã¾ã™ã€‚",
    applyCount: 1,
    favoriteCount: 8,
    deadline: "12/24(ç«) 15:00",
    deadlineDate: new Date('2025-12-24T15:00:00'),
  },
  {
    id: 5,
    type: "regular",
    date: "æ¯é€±æœˆãƒ»æ°´ 09:00ã€œ14:00",
    duration: "2025/2/1ã€œ2025/7/31",
    location: "æ±äº¬éƒ½ å“å·åŒº (å¤§å´é§… å¾’æ­©2åˆ†)",
    minRate: 2000,
    maxRate: 2200,
    parentHistory: 3,
    tags: ["è‡ªå®…ä¿è‚²"],
    childAge: "3æ­³",
    description: "åœ¨å®…ãƒ¯ãƒ¼ã‚¯ä¸­ã®éŠã³ç›¸æ‰‹ã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚ä¼šè­°ä¸­ã¯ãŠéƒ¨å±‹ã§é™ã‹ã«éŠã¹ã‚‹æ–¹ã€å·¥ä½œã‚„ãŠçµµæããŒå¾—æ„ãªæ–¹ã ã¨åŠ©ã‹ã‚Šã¾ã™ã€‚",
    applyCount: 2,
    favoriteCount: 15,
    deadline: "1/20(æœˆ) 12:00",
    deadlineDate: new Date('2026-01-20T12:00:00'),
  },
  {
    id: 6,
    type: "single",
    date: "12/28(åœŸ) 10:00ã€œ15:00",
    location: "æ±äº¬éƒ½ æ–°å®¿åŒº (ç¥æ¥½å‚é§… å¾’æ­©4åˆ†)",
    minRate: 2200,
    maxRate: 2400,
    parentHistory: 8,
    tags: ["è‡ªå®…ä¿è‚²"],
    childAge: "5æ­³",
    description: "å¤§æƒé™¤ã®é–“ã€å­ä¾›ã‚’è¦‹ã¦ã„ã¦ã»ã—ã„ã§ã™ã€‚è¿‘æ‰€ã®å…¬åœ’ã«é€£ã‚Œå‡ºã—ã¦ã„ãŸã ã‘ã‚‹ã¨éå¸¸ã«åŠ©ã‹ã‚Šã¾ã™ã€‚ãŠæ˜¼ä»£ã¯ã“ã¡ã‚‰ã§è² æ‹…ã—ã¾ã™ã€‚",
    applyCount: 5,
    favoriteCount: 10,
    deadline: "12/27(é‡‘) 10:00",
    deadlineDate: new Date('2025-12-27T10:00:00'),
  },
  {
    id: 7,
    type: "single",
    date: "1/2(æœ¨) 11:00ã€œ14:00",
    location: "æ±äº¬éƒ½ ä¸­å¤®åŒº (å‹ã©ãé§… å¾’æ­©1åˆ†)",
    minRate: 3500,
    maxRate: 4000,
    parentHistory: 200,
    tags: ["è‡ªå®…ä¿è‚²"],
    childAge: "2æ­³, 4æ­³",
    description: "ãŠæ­£æœˆã®æ¥å®¢å¯¾å¿œä¸­ã€å­ä¾›ãŸã¡ã¨åˆ¥å®¤ã§éŠã‚“ã§ã„ãŸã ã‘ã‚‹æ–¹ã‚’æ¢ã—ã¦ã„ã¾ã™ã€‚ãŠå¹´ç‰ã¨ã—ã¦æ™‚çµ¦ã¯é«˜ã‚ã«è¨­å®šã•ã›ã¦ã„ãŸã ãã¾ã—ãŸã€‚",
    applyCount: 12,
    favoriteCount: 45,
    deadline: "12/30(æœˆ) 18:00",
    deadlineDate: new Date('2025-12-30T18:00:00'),
  },
  {
    id: 8,
    type: "regular",
    date: "æ¯é€±é‡‘æ›œ 17:00ã€œ20:00",
    duration: "2025/1/10ã€œ2025/6/30",
    location: "ç¥å¥ˆå·çœŒ æ¨ªæµœå¸‚ (æ¨ªæµœé§… å¾’æ­©10åˆ†)",
    minRate: 1800,
    maxRate: 2100,
    parentHistory: 2,
    tags: ["é€è¿"],
    childAge: "å°å­¦ç”Ÿ",
    description: "ç¿’ã„äº‹ï¼ˆã‚¹ã‚¤ãƒŸãƒ³ã‚°ï¼‰ã¸ã®é€è¿ã¨ã€å¸°å®…å¾Œã®å¤•é£Ÿã®æ¸©ã‚ç›´ã—ã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚å¾’æ­©10åˆ†ç¨‹åº¦ã®è·é›¢ã§ã™ã€‚",
    applyCount: 1,
    favoriteCount: 3,
    deadline: "1/5(æ—¥) 20:00",
    deadlineDate: new Date('2026-01-05T20:00:00'),
  },
  {
    id: 9,
    type: "single",
    date: "12/23(æœˆ) 09:00ã€œ17:00",
    location: "æ±äº¬éƒ½ æ­¦è”µé‡å¸‚ (å‰ç¥¥å¯ºé§… å¾’æ­©15åˆ†)",
    minRate: 2100,
    maxRate: 2600,
    parentHistory: 10,
    tags: ["è‡ªå®…ä¿è‚²"],
    childAge: "0æ­³",
    description: "ç”Ÿå¾Œ6ãƒ¶æœˆã®èµ¤ã¡ã‚ƒã‚“ã§ã™ã€‚é›¢ä¹³é£ŸãŒå§‹ã¾ã£ã¦ã„ã¾ã™ã€‚ç§ï¼ˆæ¯è¦ªï¼‰ã‚‚åœ¨å®…ã§ã™ãŒã€åˆ¥å®¤ã§ä»•äº‹ã‚’ã—ã¾ã™ã€‚",
    applyCount: 4,
    favoriteCount: 9,
    deadline: "12/17(ç«) 15:00", // ä»Šæ—¥ç· åˆ‡ï¼ˆæ®‹ã‚Šæ™‚é–“ã‚ãšã‹ï¼‰
    deadlineDate: new Date('2025-12-17T15:00:00'),
  },
  {
    id: 10,
    type: "single",
    date: "12/31(ç«) 18:00ã€œ23:00",
    location: "æ±äº¬éƒ½ æ±Ÿæ±åŒº (è±Šæ´²é§… å¾’æ­©3åˆ†)",
    minRate: 4000,
    maxRate: 5000,
    parentHistory: 30,
    tags: ["è‡ªå®…ä¿è‚²"],
    childAge: "1æ­³",
    description: "å¤§æ™¦æ—¥ã«å¤«å©¦ã§å°‘ã—ã ã‘å¤–å‡ºã—ãŸã„ã§ã™ã€‚ç´…ç™½æ­Œåˆæˆ¦ã‚’è¦‹ãªãŒã‚‰ã€ã®ã‚“ã³ã‚Šéã”ã—ã¦ã„ãŸã ã‘ã‚Œã°ã¨æ€ã„ã¾ã™ã€‚",
    applyCount: 6,
    favoriteCount: 20,
    deadline: "12/18(æ°´) 10:00", // æ˜æ—¥ç· åˆ‡
    deadlineDate: new Date('2025-12-18T10:00:00'),
  }
];

// -----------------------------------------------------------------------------
// ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼šä¿è­·è€…ãƒ“ãƒ¥ãƒ¼ï¼ˆå‹Ÿé›†ä½œæˆ - æ™‚çµ¦è¨­å®šï¼‰
// -----------------------------------------------------------------------------
const ParentCreateView = () => {
  const [minRate, setMinRate] = useState(1800);
  const [maxRate, setMaxRate] = useState(2000);
  const [matchCount, setMatchCount] = useState(0);
  const [applyProb, setApplyProb] = useState(0);
  const [marketStatus, setMarketStatus] = useState("low");

  useEffect(() => {
    let count = 3;
    let prob = 20;
    const rateDiff = maxRate - 1800;
    if (rateDiff > 0) {
      count += Math.floor(rateDiff / 50);
      prob += Math.floor(rateDiff / 20);
    }
    const range = maxRate - minRate;
    if (range >= 500) {
      count += 5;
      prob += 15;
    }
    if (prob > 99) prob = 99;
    setMatchCount(count);
    setApplyProb(prob);
    if (maxRate < 2000) setMarketStatus("low");
    else if (maxRate < 2500) setMarketStatus("mid");
    else setMarketStatus("high");
  }, [minRate, maxRate]);

  return (
    <div className="bg-white min-h-screen pb-20" style={FONT_STYLE}>
      <div className="p-4 shadow-sm sticky top-0 z-10 flex items-center bg-white">
        <button className="mr-4">â†</button>
        <h1 className="text-lg font-bold flex-1 text-center">æ™‚çµ¦ã®è¨­å®š</h1>
        <div className="w-8"></div>
      </div>
      <div className="p-4 space-y-6">
        <div className="p-6 rounded-xl border border-gray-100 shadow-sm space-y-6 bg-white">
          <h2 className="font-bold text-lg">ã”å¸Œæœ›ã®æ™‚çµ¦ç¯„å›²</h2>
          <div>
            <label className="text-xs opacity-70 font-bold block mb-2">å¸Œæœ›é‡‘é¡ï¼ˆä¸‹é™ï¼‰</label>
            <div className="flex items-center gap-2">
              <input type="number" value={minRate} onChange={(e) => setMinRate(Number(e.target.value))}
                className="flex-1 p-3 border rounded-lg text-lg font-bold text-right outline-none focus:ring-2"
                style={{ borderColor: '#E5E5E5', color: COLORS.text }} />
              <span className="font-bold">å†† ã€œ</span>
            </div>
          </div>
          <div>
            <div className="flex justify-between items-end mb-2">
              <label className="text-xs opacity-70 font-bold">ãŠæ”¯æ‰•ã„ä¸Šé™ï¼ˆã“ã“ã¾ã§ãªã‚‰å‡ºã›ã‚‹ï¼‰</label>
            </div>
            <div className="flex items-center gap-2 mb-4">
               <input type="number" value={maxRate} onChange={(e) => setMaxRate(Number(e.target.value))}
                className="flex-1 p-3 border-2 rounded-lg text-2xl font-bold text-right"
                style={{ borderColor: COLORS.main, backgroundColor: COLORS.sub, color: COLORS.text }} />
              <span className="font-bold text-lg">å††</span>
            </div>
            <div className="flex flex-col gap-1 mb-4 text-xs bg-gray-50 p-2 rounded">
              <span className="font-bold opacity-80">ğŸ’¡ å‚è€ƒæƒ…å ±</span>
              <span className="opacity-70">ãŠä½ã¾ã„ã®ã‚¨ãƒªã‚¢ï¼ˆä¸–ç”°è°·åŒºï¼‰ã®å¹³å‡æ™‚çµ¦ï¼š2,300å††</span>
            </div>
            <input type="range" min="1800" max="4000" step="50" value={maxRate} onChange={(e) => setMaxRate(Number(e.target.value))}
              className="w-full h-3 rounded-lg appearance-none cursor-pointer"
              style={{ accentColor: COLORS.main, backgroundColor: '#D1D5DB' }} />
             <p className="text-xs opacity-50 mt-2 text-center">ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚’å‹•ã‹ã—ã¦èª¿æ•´</p>
          </div>
        </div>
        <div className="p-5 rounded-xl border transition-all duration-300 bg-white shadow-sm" style={{ borderColor: COLORS.main }}>
          <h3 className="text-center font-bold mb-4 opacity-80">ã“ã®æ¡ä»¶ã§ã®è¦‹è¾¼ã¿</h3>
          <div className="flex justify-between items-center mb-4">
            <div className="text-center w-1/2 border-r border-gray-200">
              <p className="text-xs opacity-60 mb-1">è¿‘ãã®å¯¾è±¡ã‚·ãƒƒã‚¿ãƒ¼</p>
              <p className="text-3xl font-bold">{matchCount}<span className="text-sm font-normal ml-1">äºº</span></p>
            </div>
            <div className="text-center w-1/2">
              <p className="text-xs opacity-60 mb-1">å¿œå‹ŸãŒæ¥ã‚‹ç¢ºç‡</p>
              <div className="text-3xl font-bold" style={{ color: applyProb > 80 ? '#D65A31' : COLORS.text }}>
                {applyProb}<span className="text-sm font-normal ml-1">%</span>
              </div>
            </div>
          </div>
          <div className="text-sm p-3 rounded-lg flex gap-2" style={{ backgroundColor: COLORS.sub }}>
            {marketStatus === 'low' && (
              <>
                <AlertCircle className="shrink-0" size={20} color="#D65A31" />
                <p>ä¸Šé™ã‚’ã‚ã¨<span className="font-bold" style={{ color: '#D65A31' }}>300å††</span>ä¸Šã’ã‚‹ã¨ã€çµŒé¨“è±Šå¯Œãªã‚·ãƒƒã‚¿ãƒ¼ã‚‚å«ã‚ã¦å¯¾è±¡ãŒåºƒãŒã‚Šã¾ã™ã€‚</p>
              </>
            )}
            {marketStatus === 'mid' && (
              <>
                <Info className="shrink-0" size={20} color={COLORS.main} />
                <p>æ¨™æº–çš„ãªè¨­å®šã§ã™ã€‚æ€¥ãã®å ´åˆã¯ã‚‚ã†å°‘ã—ä¸Šé™ã‚’ä¸Šã’ã‚‹ã¨ã‚ˆã‚Šç¢ºå®Ÿã§ã™ã€‚</p>
              </>
            )}
            {marketStatus === 'high' && (
              <>
                <CheckCircle className="shrink-0" size={20} color="green" />
                <p>ååˆ†ãªé‡‘é¡è¨­å®šã§ã™ï¼å¤šãã®ã‚·ãƒƒã‚¿ãƒ¼ã‹ã‚‰ã®å¿œå‹ŸãŒè¦‹è¾¼ã‚ã¾ã™ã€‚</p>
              </>
            )}
          </div>
        </div>
      </div>
    </div>
  );
};

// -----------------------------------------------------------------------------
// ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼šã‚·ãƒƒã‚¿ãƒ¼ãƒ“ãƒ¥ãƒ¼ï¼ˆå‹Ÿé›†ä¸€è¦§ï¼‰
// -----------------------------------------------------------------------------
const SitterListView = () => {
  const [likedJobs, setLikedJobs] = useState<number[]>([]);

  const toggleLike = (id: number) => {
    if (likedJobs.includes(id)) {
      setLikedJobs(likedJobs.filter(jobId => jobId !== id));
    } else {
      setLikedJobs([...likedJobs, id]);
    }
  };

  // å®Ÿç¸¾ã‚¿ã‚°ã®ç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯ (åˆå›ã®ã¿è¡¨ç¤º)
  const getHistoryTag = (count: number) => {
    if (count === 0) return { label: "ğŸ”° åˆã‚ã¦ã®åˆ©ç”¨", show: true };
    return { label: "", show: false };
  };

  // æ®‹ã‚Šæ™‚é–“è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯
  const getRemainingTime = (deadline: Date) => {
    const diff = deadline.getTime() - CURRENT_MOCK_DATE.getTime();
    if (diff <= 0) return { text: "æœŸé™åˆ‡ã‚Œ", isUrgent: false };
    
    const hours = Math.floor(diff / (1000 * 60 * 60));
    const days = Math.floor(hours / 24);

    if (days > 0) {
      return { text: `æ®‹ã‚Š${days}æ—¥`, isUrgent: days <= 1 }; // 1æ—¥ä»¥å†…ãªã‚‰ç·Šæ€¥
    } else {
      return { text: `æ®‹ã‚Š${hours}æ™‚é–“`, isUrgent: true }; // 24æ™‚é–“æœªæº€ã¯å¸¸ã«ç·Šæ€¥
    }
  };

  return (
    <div className="min-h-screen pb-20" style={{ ...FONT_STYLE, backgroundColor: '#FAFAFA' }}>
      <div className="bg-white p-4 shadow-sm sticky top-0 z-10 flex justify-center items-center">
        <h1 className="text-lg font-bold">å‹Ÿé›†ä¸€è¦§</h1>
        <button className="absolute right-4 p-2">
            <Filter size={20} color={COLORS.text}/>
        </button>
      </div>
      <div className="flex gap-2 p-4 overflow-x-auto whitespace-nowrap bg-white border-b border-gray-100">
        <span className="px-4 py-1.5 text-white rounded-full text-sm font-bold" style={{ backgroundColor: COLORS.text }}>ã™ã¹ã¦</span>
        <span className="px-4 py-1.5 bg-gray-100 rounded-full text-sm">é«˜æ™‚çµ¦</span>
        <span className="px-4 py-1.5 bg-gray-100 rounded-full text-sm">å®šæœŸ</span>
        <span className="px-4 py-1.5 bg-gray-100 rounded-full text-sm">è¿‘æ‰€</span>
      </div>

      <div className="p-4 space-y-4">
        {JOB_LISTINGS.map((job) => {
          const isRegular = job.type === 'regular';
          const mainColor = isRegular ? COLORS.regularMain : COLORS.singleMain;
          const bgColor = isRegular ? COLORS.regularBg : COLORS.singleBg;
          const historyTag = getHistoryTag(job.parentHistory);
          const remaining = getRemainingTime(job.deadlineDate);
          
          return (
            <div key={job.id} className="bg-white rounded-xl shadow-sm overflow-hidden border border-gray-100 relative">
              
              {/* Type Badge Header */}
              <div className="px-4 py-2 flex items-center justify-between" style={{ backgroundColor: bgColor, color: COLORS.text }}>
                 <div className="flex items-center gap-1.5 font-bold text-sm">
                    {isRegular ? (<><Calendar size={16} color={mainColor} fill={mainColor} className="opacity-80"/> å®šæœŸ</>) : (<><Clock size={16} color={mainColor} fill={mainColor} className="opacity-80"/> å˜ç™º</>)}
                 </div>
                 {/* å®šæœŸã®æœŸé–“ã®ã¿è¡¨ç¤º */}
                 {isRegular && job.duration && (
                   <span className="text-xs font-medium opacity-90">{job.duration}</span>
                 )}
              </div>

              {/* === SECTION 1: ã‚·ãƒƒãƒ†ã‚£ãƒ³ã‚°æƒ…å ± === */}
              <div className="p-5 pb-4">
                
                {/* æ—¥æ™‚ */}
                <div className="flex items-center text-lg font-bold leading-tight mb-3">
                   {job.date}
                </div>

                {/* ã‚¨ãƒªã‚¢ã¨æ™‚çµ¦ã‚’ä¸¦åˆ—ï¼ˆãƒªã‚¹ãƒˆå½¢å¼ï¼‰ã«é…ç½® */}
                <div className="flex flex-col gap-2 mb-4">
                    {/* å ´æ‰€ */}
                    <div className="flex items-start gap-3">
                        <div className="w-5 flex justify-center mt-0.5"><MapPin size={18} className="text-gray-400 opacity-80" /></div>
                        <span className="text-base font-medium opacity-90 leading-snug">{job.location}</span>
                    </div>
                    {/* æ™‚çµ¦ */}
                    <div className="flex items-center gap-3">
                       <div className="w-5 flex justify-center"><CircleDollarSign size={18} className="text-gray-400 opacity-80" /></div>
                       <div className="text-base font-medium opacity-90">
                         æ™‚çµ¦ {job.minRate.toLocaleString()}ã€œ{job.maxRate.toLocaleString()}å††
                       </div>
                    </div>
                </div>

                {/* è©³ç´°ãƒ†ã‚­ã‚¹ãƒˆ (å†’é ­ã®ã¿) - NEW */}
                <div className="mb-4">
                   <p className="text-sm text-gray-600 line-clamp-2 leading-relaxed">
                      {job.description}
                   </p>
                </div>

                {/* ã‚¿ã‚° & å¹´é½¢ */}
                <div className="flex flex-wrap gap-2">
                   {/* ä¿è­·è€…å®Ÿç¸¾ã‚¿ã‚° (åˆå›ã®ã¿è¡¨ç¤º) */}
                   {historyTag.show && (
                     <span className="text-xs opacity-70 bg-gray-50 px-2 py-0.5 rounded border border-gray-100 font-bold flex items-center gap-1">
                        {historyTag.label}
                     </span>
                   )}

                   {/* é€šå¸¸ã‚¿ã‚° */}
                   {job.tags.map(tag => (<span key={tag} className="text-xs opacity-70 bg-gray-50 px-2 py-0.5 rounded border border-gray-100">#{tag}</span>))}
                   
                   {/* å¹´é½¢ */}
                   <span className="text-xs opacity-70 bg-gray-50 px-2 py-0.5 rounded border border-gray-100 flex items-center"><Baby size={12} className="mr-1"/> {job.childAge}</span>
                </div>
              </div>

              {/* åŒºåˆ‡ã‚Šç·š */}
              <div className="w-full h-px bg-gray-100"></div>

              {/* === SECTION 3: å‹Ÿé›†æƒ…å ±ãƒ»ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ (Footer) === */}
              <div className="bg-white px-5 py-3 flex justify-between items-center border-t border-gray-100">
                 
                 {/* Left: æœŸé™ãƒ»å¿œå‹Ÿæ•° (æ®‹ã‚Šæ™‚é–“ã‚’æœŸé™ã®å³ã¸) */}
                 <div className="flex flex-col gap-1.5">
                    <div className="flex items-center gap-2">
                       <div className="flex items-center gap-1 text-[10px] opacity-60 font-bold">
                          <Timer size={12} /> æœŸé™ {job.deadline}
                       </div>
                       {/* æ®‹ã‚Šæ™‚é–“ */}
                       <span className={`text-[10px] font-bold ${remaining.isUrgent ? 'text-red-500' : 'text-gray-400'}`}>
                          ({remaining.text})
                       </span>
                    </div>

                    {/* å¿œå‹Ÿæ•° */}
                    <div className="flex items-center gap-1 text-xs font-bold" style={{ color: '#D65A31' }}>
                       <Users size={14} />
                       <span>{job.applyCount}äººãŒå¿œå‹Ÿ</span>
                    </div>
                 </div>

                 {/* Right: Actions */}
                 <div className="flex gap-2">
                    <button onClick={() => toggleLike(job.id)} className={`h-10 px-3 flex justify-center items-center rounded-full border transition-all gap-1.5 ${likedJobs.includes(job.id) ? 'bg-pink-50 border-pink-200' : 'bg-white border-gray-200'}`}>
                      <Heart size={18} fill={likedJobs.includes(job.id) ? "#EC4899" : "none"} color={likedJobs.includes(job.id) ? "#EC4899" : "#9CA3AF"} />
                      <span className="text-xs font-bold text-gray-400">{job.favoriteCount + (likedJobs.includes(job.id) ? 1 : 0)}</span>
                    </button>
                    <button className="px-5 h-10 rounded-full font-bold text-white shadow-sm flex items-center justify-center text-sm" style={{ backgroundColor: COLORS.main }}>
                      è©³ç´° <ChevronRight size={16} className="ml-0.5"/>
                    </button>
                 </div>
              </div>

            </div>
          );
        })}
      </div>
    </div>
  );
};

// -----------------------------------------------------------------------------
// App
// -----------------------------------------------------------------------------
const App = () => {
  const [view, setView] = useState<'parent' | 'sitter'>('parent');
  return (
    <div className="flex justify-center bg-gray-100 min-h-screen font-sans">
      <div className="w-full max-w-md bg-white min-h-screen relative shadow-2xl overflow-hidden">
        <div className="fixed top-24 right-4 z-50 flex flex-col gap-2">
            <button onClick={() => setView('parent')} className={`px-4 py-2 rounded-full shadow-lg text-sm font-bold transition-all border ${view === 'parent' ? 'text-white border-transparent' : 'bg-white text-gray-600 border-gray-200'}`} style={{ backgroundColor: view === 'parent' ? COLORS.main : 'white' }}>ä¿è­·è€…ç”»é¢</button>
            <button onClick={() => setView('sitter')} className={`px-4 py-2 rounded-full shadow-lg text-sm font-bold transition-all border ${view === 'sitter' ? 'text-white border-transparent' : 'bg-white text-gray-600 border-gray-200'}`} style={{ backgroundColor: view === 'sitter' ? COLORS.text : 'white' }}>ã‚·ãƒƒã‚¿ãƒ¼ç”»é¢</button>
        </div>
        {view === 'parent' ? <ParentCreateView /> : <SitterListView />}
      </div>
    </div>
  );
};

export default App;